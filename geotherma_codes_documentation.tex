\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{float}
\usepackage{breqn}
\usepackage{graphicx}
\usepackage[labelformat=empty]{caption}
\usepackage{outlines}
\author{Calvin A. Whealton (caw324@cornell.edu)}
\title{Geothermal Play Fairway Analysis Codes Documentation}

\begin{document}

\maketitle
The following document provides supporting information for codes written by Calvin Whealton for the Geothermal Play Fairway Analysis grant. This is not a comprehensive list of all codes written for the project.

\section*{Bottom-hole Temperature Corrections}

These scripts, codes, and documents pertain to the bottom-hole temperature correction calculations.

\subsection*{\textsf{func\_BHT\_NY\_PA\_WV\_corr.R}}

\textbf{Description}: Script with a function to compute bottom-hole temperature corrections for NY, PA, and WV based on the region. Function accepts a R data frame and returns the data frame with two additional columns for the corrected bottom-hole temperature and the error.

\begin{table}[H]
\begin{tabular} {p{2cm} p{11cm}}
\hline
\textbf{Variable} & \textbf{Description}\\
\hline
\textsf{X} 			 & R data frame with variables named\\
 & \textsf{bht\_c}: Recorded bottom-hole temperature in Celsius\\
 & \textsf{calc\_depth\_m}: Calculated depth of well in meters\\
 & \textsf{reg}:  Region for that point, 0=Rome Trough and areas south east in PA, 1=Allegheny Plateau (NY and north east PA), and 2=West VA\\
\hline
\end{tabular} 
\end{table}

The output is a data frame with the following columns added.

\begin{table}[H]
\begin{tabular} {p{2cm} p{11cm}}
\hline
\textbf{Output} & \textbf{Description}\\
\hline
\textsf{corr\_bht\_c} 	 & Corrected bottom-hole temperature in Celsius \\
\textsf{corr\_error}		 & Error from calculation of correcting the bottom-hole temperature\\
  & 0: no errors\\
  & 20: depth outside of normal range\\
  & 21: depth is negative\\
  & 22: depth is missing for Allegheny Plateau or West Virginia data\\
  & 30: categorical variable not 0,1, or 2\\
  & 32: categorical variable missing\\
  & 42: bottom-hole missing\\
\hline
\end{tabular} 
\end{table}

\textbf{Equations}: The equations used to calculate the temperature correction $\Delta T$ are given below. Depth ($z_0$) is in meters and temperature correction ($\Delta T$) is in Celsius. See Frone and Blackwell (2010) for details of the West Virginia correction.

\begin{equation} \label{DT_ap}
{\Delta T}_{Alle. Plat.} =  \left\{
\begin{array}{ll}
\max\{0,-23.48 + (1.791\times 10^{-2})z_0\},	& (z_0 < 4000 \mathrm{m})\\
48.16,  & (z_0 > 4000 \mathrm{m})\\
\end{array} \right .
\end{equation}

\begin{equation} \label{DT_rt}
{\Delta T}_{Rome Tr.} = 0
\end{equation}

\begin{equation} \label{DT_wva}
{\Delta T}_{WV} =  \left\{
\begin{array}{ll}
0,	& (z_0 < 1000 \mathrm{m})\\
-16.51 + (1.83\times 10^{-2})z_0 +(2.34\times 10^{-6})z_0^2 ,  & (1000 \mathrm{m} < z_0 < 3860 m)\\
19.07, & (z_0 > 3860 m)\\
\end{array} \right .
\end{equation}

\subsection*{\textsf{example\_bht\_corr.R}}

\textbf{Description}: Script to run the function \textsf{func\_BHT\_NY\_PA\_WV\_corr.R} with synthetic data in \textsf{bht\_test\_data.csv}. The output should be corrected BHTs and cases that generate all errors for missing values or values outside typical ranges.

\subsection*{\textsf{bht\_test\_data.csv}}

\textbf{Description}: Synthetic data to test \textsf{func\_BHT\_NY\_PA\_WV\_corr.R} for proper corrections and generating all possible errors.

\section*{Outliers}
These codes, scripts, and files pertain to the outlier identification procedures.

\subsection*{\textsf{outlier_identification.R}}

\textbf{Description}: Script with several functions to compute outliers based using one of the specified algorithms with the specified inputs. Most algorithms have separate functions described below.

\begin{table}[H]
\begin{tabular} {p{2.5cm} p{10cm}}
\hline
\textbf{Function} & \textbf{Description}\\
\hline
\textsf{outlier\_iden} & General function to call other functions and perform outlier identification \\
\textsf{outlier\_loc\_pts} & Local outlier identification for \textsf{algo}=1\\
\textsf{outlier\_loc\_rad} & Local outlier identification for \textsf{algo}=2\\
\textsf{outlier\_loc\_grid} & Local outlier identification for \textsf{algo}=3\\
\textsf{outlier\_glob} & Global outlier identification\\
\hline
\end{tabular} 
\end{table}

\begin{table}[H]
\begin{tabular} {p{2cm} p{11cm}}
\hline
\textbf{Variable} & \textbf{Description}\\
\hline
\textsf{X} 			 & R data frame with variables named \\
 & \textsf{x\_coord}: Longitude coordinate in km\\
 & \textsf{y\_coord}: Latitude coordinate in km\\
 & \textsf{test}: Variable to be tested for being an outlier\\
\textsf{algo} & algorithm for determining local outlier\\
 & 1: (Default) Finds nearest points\\
 & 2: Finding all points within a given radius\\
 & 3: Gridding data\\
\textsf{outcri} & Outlier criteria\\
 & 1: (Default) Only local outliers flagged as outliers\\
 & 2: Only local and global outliers flagged as outliers\\
 & 3: Only global outliers flagged as outliers\\
\textsf{pt\_eval} & Number of points used in when \textsf{algo}=1 (default = 25)\\
\textsf{rad\_eval} & Radius (in km) at which to take points when \textsf{algo}=2 (default = 16)\\
\textsf{box\_size} & Size of spacing (in km) to form grids when \textsf{algo}=3 (default = 32)\\
\textsf{pt\_min} & Minimum number of points required to perform local test for \textsf{algo}=2 or 3 (default = 25)\\
\textsf{rad\_max} & Maximum radius (in km) at which to take points when \textsf{algo}=1 (default = 16)\\
\textsf{k\_glob} & Constant multiplied by the upper- and lower-half quartile ranges in global analysis (default = 3)\\
\textsf{k\_log} & Constant multiplied by the upper- and lower-half quartile ranges in local analysis (default = 3)\\
\textsf{type}	 & Type of quantile estimation (default = 7, see R documentation)\\
\hline
\end{tabular} 
\end{table}

The output is a data frame with the following columns added. The local outlier columns will only be added when \textsf{outcri}=1 or 2. The global outlier columns will only be added when \textsf{outcri}=2 or 3. The \textsf{outs} column will be present in all output.

\begin{table}[H]
\begin{tabular} {p{2cm} p{11cm}}
\hline
\textbf{Output} & \textbf{Description}\\
\hline
\textsf{outs}	 & Binary variable for points being an outlier (1=outlier)\\
\hline
\textsf{out\_loc\_lo} & Binary variable for point being a local low outlier (1=outlier)) \\
\textsf{out\_loc\_hi} & Binary variable for point being a local high outlier (1=outlier) \\
\textsf{out\_loc\_lq} & Lower quartile for local outlier test (NA if not tested) \\
\textsf{out\_loc\_mq} & Median for local outlier test (NA if not tested) \\
\textsf{out\_loc\_uq} & Upper for local outlier test (NA if not tested) \\
\textsf{out\_loc\_lb} & Lower bound for local outlier test (NA if not tested)\\
\textsf{out\_loc\_ub} & Upper bound for local outlier test (NA if not tested)\\
\textsf{out\_loc\_rad} & Maximum distance to point (only for algo=1)\\
\textsf{out\_loc\_pts} & Number of points in local area (only for algo=2 and 3)\\
\textsf{out\_loc\_error} & Error in local outlier calculation\\
 & 0: No errors\\
 & 1: Some points outside \textsf{rad\_max} when \textsf{algo}=1)\\
 & 2: Fewer than \textsf{pt\_min} points in region when \textsf{algo}=2 or 3)\\
\hline
\textsf{out\_glob\_lo} &  Binary variable for points being an global low outlier (1=outlier)\\
\textsf{out\_glob\_hi} &  Binary variable for points being an global high outlier (1=outlier)\\
\hline
\end{tabular} 
\end{table}

\textbf{Equations}: The equations used to calculate low and high outlier bounds are given below. In these equations $q$ is a variable of interest (\textsf{test} in the data) with subscripts denoting quantiles and $k$ is the constant (\textsf{k\_loc} or \textsf{k\_glob}). The equations can be applied locally or globally. Aguirre (2014) uses an outlier test that is similar, but the version implemented in this code is more flexible.

\begin{equation} \label{lb}
B_{lower} = q_{0.25} - k(q_{0.5} - q_{0.25})
\end{equation}

\begin{equation} \label{ub}
B_{upper} = q_{0.75} + k(q_{0.75} - q_{0.5})
\end{equation}

\subsection*{\textsf{example\_outlier\_code.R}}

\textbf{Description}: Script to run outlier identification functions with test data and the Cornell dataset. Later portions do not need to be run because they were testing sensitivity of the algorithm to the input parameters. They are kept in the code for potential future analysis.

\subsection*{\textsf{out\_test\_grid.csv}}

\textbf{Description}: Synthetic data to test the local outlier identification algorithm that uses gridding.

\subsection*{\textsf{out\_test\_rad.csv}}

\textbf{Description}: Synthetic data to test the local outlier identification algorithm that uses maximum radius.

\subsection*{\textsf{out\_test\_pt.csv}}

\textbf{Description}: Synthetic data to test the local outlier identification algorithm that uses number of points.

\subsection*{\textsf{cornell\_data.csv}}

\textbf{Description}: Cornell heat flow database with 8,919 points used to test sensitivity of the outlier identification algorithm.


\section*{References}

Aguirre, G. A. (2014). \textit{Geothermal Resource Assessment: A Case Study of Spatial Variability and Uncertainty Analysis for the States of New York and Pennsylvania}. Master's Thesis, Environmental and Water Resources Systems Engineering, School of Civil and Environmental Engineering, Cornell University.\hfill
\bigskip

\noindent
Frone, Z. and Blackwell, D. (2010). Geothermal Map of the Northeastern United States and the West Virginia Thermal Anomaly. \textit{Geothermal Resources Council Transactions 34}:339-344.

\end{document}